<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="sheet-body">

    <form method="POST">
        <input type="hidden" name="modelo_id" value="{{ modelo.id }}">
        
        <div class="sheet-header" style="border:none;">
            <h1 style="font-size: 1.8rem;">
                {% if p %}Editando {{ p.nome }}{% else %}Novo: {{ modelo.nome }}{% endif %}
            </h1>
        </div>

        <!-- Dados Fixos (Todo personagem tem) -->
        <div class="form-grid">
            <div class="form-group">
                <label>Nome do Personagem</label>
                <input type="text" name="nome" value="{{ p.nome if p else '' }}" required autocomplete="off">
            </div>
            <div class="form-group">
                <label>Nível Global</label>
                <input type="number" name="nivel" value="{{ p.nivel if p else 1 }}" style="width: 80px;">
            </div>
        </div>

        <hr style="border: 0; border-top: 1px solid #8a6d3b; margin: 20px 0;">

        <!-- CAMPOS DINÂMICOS DO MODELO -->
        <!-- Lógica: Divide inteiros (stats) de textos para organização visual -->
        
        <h3 style="font-family: var(--font-main); color: #5c4033;">Atributos & Status</h3>
        <div class="stats-inputs" style="grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));">
            {% for campo in modelo.campos %}
                {% if campo.tipo == 'inteiro' %}
                    <div class="form-group">
                        <label>{{ campo.nome }}</label>
                        <!-- Recupera valor do dicionário 'valores' usando o ID do campo -->
                        <input type="number" name="campo_{{ campo.id }}" 
                               value="{{ valores.get(campo.id, '') if valores else '' }}">
                    </div>
                {% endif %}
            {% endfor %}
        </div>

        <div style="margin-top: 20px;">
            {% for campo in modelo.campos %}
                
                <!-- Booleanos -->
                {% if campo.tipo == 'booleano' %}
                    <div class="form-group" style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        {% set val = valores.get(campo.id, 'Não') if valores else 'Não' %}
                        <input type="checkbox" name="campo_{{ campo.id }}" style="width: auto;" 
                               {% if val == 'Sim' %}checked{% endif %}>
                        <label style="margin:0; cursor: pointer;">{{ campo.nome }}</label>
                    </div>
                {% endif %}

                <!-- Textos -->
                {% if campo.tipo == 'texto' %}
                    <div class="form-group">
                        <label>{{ campo.nome }}</label>
                        <textarea name="campo_{{ campo.id }}" rows="2">{{ valores.get(campo.id, '') if valores else '' }}</textarea>
                    </div>
                {% endif %}

            {% endfor %}
        </div>

        <!-- Botões de Ação -->
        <div style="text-align: center; margin-top: 30px;">
            <button type="submit" name="salvar_ficha" class="btn btn-save">Gravar na Pedra</button>
            <a href="{{ url_for('index') }}" target="_top" class="btn" style="background: #7f8c8d;">Cancelar</a>
        </div>
    </form>

</body>
</html>